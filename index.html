<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parfum Formulator</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
  </head>
  <body data-theme="light">
    <main class="app-shell">
      <header class="hero">
        <div class="brand">
          <svg
            class="brand-logo"
            viewBox="0 0 160 120"
            role="img"
            aria-label="Parfum Formulator logo"
          >
            <g
              fill="none"
              stroke="currentColor"
              stroke-width="5"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M22 104H10V78c0-12.5 9.4-19.3 19.3-24.7 8.4-4.6 13.7-10.6 13.7-21.3V28c0-6.6-4.9-11.4-11.5-11.4H18"
              />
              <path d="M42 18V10.5c0-4.7 3.7-8.5 8.5-8.5H72" />
              <path
                d="M74 104h42c18 0 32-14 32-32V62c0-18-14-32-32-32h-14c-7 0-13 6-13 13v6h-6c-16 0-28 12-28 28v6c0 11 6 20 15 25"
              />
              <path d="M104 24h30" />
              <path d="M126 18c8.3 0 15 6.7 15 15" />
            </g>
            <text
              x="32"
              y="46"
              font-family="'Inter', 'Segoe UI', sans-serif"
              font-size="28"
              font-weight="600"
              fill="currentColor"
            >
              2œÄ
            </text>
          </svg>
          <div class="brand-text">
            <h1>Parfum Formulator</h1>
            <p>
              Disegna, valuta e perfeziona le tue formule in modo intuitivo, sempre con
              una visione chiara della piramide olfattiva.
            </p>
          </div>
        </div>
        <div class="hero-actions">
          <button
            id="themeToggle"
            class="theme-toggle"
            type="button"
            aria-label="Passa alla modalit√† scura"
            title="Passa alla modalit√† scura"
          >
            <span class="icon sun" aria-hidden="true">‚òÄÔ∏è</span>
            <span class="icon moon" aria-hidden="true">üåô</span>
          </button>
          <button id="newFormulaBtn" class="ghost-btn" type="button">Nuova formula</button>
        </div>
      </header>

      <section class="card" id="batchSection">
        <h2>Dosaggio Batch</h2>
        <div class="grid">
          <label class="field">
            <span>Nome Formula</span>
            <input id="formulaName" type="text" placeholder="Es. Aurora" />
          </label>
          <label class="field">
            <span>Tipologia</span>
            <select id="formulaType">
              <option value="EDT">Eau de Toilette</option>
              <option value="EDP" selected>Eau de Parfum</option>
              <option value="Parfum">Extrait / Parfum</option>
              <option value="Cologne">Cologne</option>
            </select>
          </label>
          <label class="field">
            <span>Lotto (g)</span>
            <input
              id="batchWeight"
              type="number"
              min="0"
              step="0.01"
              value="100"
              inputmode="decimal"
            />
          </label>
          <label class="field">
            <span>Densit√† media (g/ml)</span>
            <input
              id="density"
              type="number"
              min="0.1"
              step="0.01"
              value="0.94"
              inputmode="decimal"
            />
          </label>
          <label class="field">
            <span>Lotto (ml)</span>
            <output id="batchVolume">106.38</output>
          </label>
          <label class="field">
            <span>Lotto (gocce)</span>
            <output id="batchDrops">2127</output>
          </label>
        </div>
        <p class="microcopy">
          Conversioni basate su 1 ml = densit√† inserita e 20 gocce per millilitro. Regola
          a piacere per la tua filiera produttiva.
        </p>
      </section>

      <section class="card" id="materialsSection">
        <div class="section-header">
          <h2>Materie Prime</h2>
          <div class="section-actions">
            <button id="addMaterialBtn" type="button">Aggiungi nota</button>
            <button id="clearMaterialsBtn" class="ghost-btn" type="button">Svuota</button>
          </div>
        </div>
        <div class="materials-table" id="materialsTable"></div>
        <p class="microcopy">
          Inserisci le note aromatiche in grammi. Le conversioni in ml, gocce e percentuali sono
          calcolate automaticamente rispetto al lotto.
        </p>
      </section>

      <section class="card" id="insightsSection">
        <h2>Analisi automatica</h2>
        <div class="insights-grid">
          <div>
            <h3>Piramide olfattiva</h3>
            <ul id="pyramidList" class="pyramid"></ul>
          </div>
          <div>
            <h3>Famiglia predominante</h3>
            <p id="familyBadge" class="badge">-</p>
          </div>
          <div>
            <h3>Bilanciamento</h3>
            <p id="scoreValue" class="score">-</p>
          </div>
          <div>
            <h3>Miglioramenti suggeriti</h3>
            <ul id="improvementList" class="suggestions"></ul>
          </div>
        </div>
      </section>

      <section class="card" id="librarySection">
        <div class="section-header">
          <h2>Biblioteca formule</h2>
          <div class="section-actions">
            <button id="saveFormulaBtn" type="button">Salva formula</button>
            <button id="exportPdfBtn" class="ghost-btn" type="button">Esporta PDF</button>
            <button id="exportExcelBtn" class="ghost-btn" type="button">Esporta Excel</button>
          </div>
        </div>
        <div id="libraryList" class="library"></div>
      </section>

      <footer class="microcopy">
        I dati restano sul tuo dispositivo (localStorage). Esporta in PDF o Excel per condividere o
        archiviare.
      </footer>
    </main>

    <template id="materialRowTemplate">
      <div class="material-row">
        <div class="material-main">
          <label class="field">
            <span>Nota</span>
            <input type="text" class="note-input" list="noteLibrary" placeholder="Seleziona" />
          </label>
        </div>
        <div class="material-amounts">
          <label class="field">
            <span>Grammi</span>
            <input type="number" class="grams-input" min="0" step="0.01" inputmode="decimal" />
          </label>
          <label class="field">
            <span>Millilitri</span>
            <input type="number" class="ml-input" min="0" step="0.01" inputmode="decimal" />
          </label>
          <label class="field">
            <span>Gocce</span>
            <input type="number" class="drops-input" min="0" step="1" inputmode="numeric" pattern="[0-9]*" />
          </label>
          <label class="field">
            <span>%</span>
            <input type="number" class="percent-input" min="0" max="100" step="0.01" inputmode="decimal" />
          </label>
          <label class="field">
            <span>Diluizione (%)</span>
            <input type="number" class="dilution-input" min="0" max="100" step="0.1" inputmode="decimal" />
          </label>
        </div>
        <button type="button" class="icon-btn remove-btn" aria-label="Rimuovi nota">‚úï</button>
      </div>
    </template>

    <datalist id="noteLibrary"></datalist>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
